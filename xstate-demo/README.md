# XState React æœ€ä½³å®è·µç¤ºä¾‹

è¿™æ˜¯ä¸€ä¸ªåŸºäº React + Vite çš„ XState v5 æœ€ä½³å®è·µç¤ºä¾‹é¡¹ç›®ï¼Œå±•ç¤ºäº†å¦‚ä½•åœ¨ React åº”ç”¨ä¸­æ­£ç¡®ä½¿ç”¨ XState æ¥ç®¡ç†å¤æ‚çš„çŠ¶æ€é€»è¾‘ã€‚

## âœ¨ ç‰¹æ€§

- âœ… **XState v5** - ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ XState API
- âœ… **TypeScript** - å®Œæ•´çš„ç±»å‹å®‰å…¨æ”¯æŒ
- âœ… **5ä¸ªå®ç”¨ç¤ºä¾‹** - æ¶µç›–å¸¸è§çš„çŠ¶æ€ç®¡ç†åœºæ™¯
- âœ… **æœ€ä½³å®è·µ** - éµå¾ª XState å®˜æ–¹æ¨èçš„ä»£ç ç»„ç»‡æ–¹å¼
- âœ… **ç°ä»£åŒ–å·¥å…·é“¾** - Vite + React 19 + TypeScript

## ğŸš€ å¿«é€Ÿå¼€å§‹

```bash
# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build
```

è®¿é—®ç»ˆç«¯ä¸­æ˜¾ç¤ºçš„æœ¬åœ°åœ°å€ï¼ˆé€šå¸¸æ˜¯ http://localhost:5173ï¼‰å³å¯ä½“éªŒç¤ºä¾‹ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ machines/           # çŠ¶æ€æœºå®šä¹‰
â”‚   â”œâ”€â”€ authMachine.ts      # ç”¨æˆ·è®¤è¯
â”‚   â”œâ”€â”€ formMachine.ts      # è¡¨å•éªŒè¯
â”‚   â”œâ”€â”€ fetchMachine.ts     # æ•°æ®è·å–
â”‚   â”œâ”€â”€ timerMachine.ts     # è®¡æ—¶å™¨
â”‚   â””â”€â”€ wizardMachine.ts    # å¤šæ­¥éª¤å‘å¯¼
â”œâ”€â”€ components/         # React ç»„ä»¶
â”‚   â”œâ”€â”€ AuthDemo.tsx
â”‚   â”œâ”€â”€ FormDemo.tsx
â”‚   â”œâ”€â”€ FetchDemo.tsx
â”‚   â”œâ”€â”€ TimerDemo.tsx
â”‚   â””â”€â”€ WizardDemo.tsx
â”œâ”€â”€ App.tsx            # ä¸»åº”ç”¨ç»„ä»¶
â””â”€â”€ main.tsx           # åº”ç”¨å…¥å£
```

## ğŸ¯ ç¤ºä¾‹åœºæ™¯

### 1. ğŸ” ç”¨æˆ·è®¤è¯çŠ¶æ€æœº (AuthDemo)

å±•ç¤ºåŸºç¡€çŠ¶æ€è½¬æ¢ã€context ç®¡ç†ã€é”™è¯¯å¤„ç†å’Œå¼‚æ­¥æ“ä½œã€‚

**æ ¸å¿ƒæ¦‚å¿µï¼š**
- çŠ¶æ€ï¼š`idle` â†’ `loading` â†’ `authenticated` / `error`
- å¼‚æ­¥è°ƒç”¨ï¼šä½¿ç”¨ `fromPromise` åŒ…è£… API è°ƒç”¨
- é”™è¯¯é‡è¯•ï¼šä» error çŠ¶æ€å¯ä»¥é‡è¯•ç™»å½•
- Context ç®¡ç†ï¼šä¿å­˜ç”¨æˆ·ä¿¡æ¯å’Œé”™è¯¯æ¶ˆæ¯

**æç¤ºï¼š** ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯ "admin"

### 2. ğŸ“ è¡¨å•éªŒè¯çŠ¶æ€æœº (FormDemo)

å±•ç¤ºåµŒå¥—çŠ¶æ€ã€å®æ—¶éªŒè¯ã€å­—æ®µçº§é”™è¯¯å¤„ç†ã€‚

**æ ¸å¿ƒæ¦‚å¿µï¼š**
- å¤šå­—æ®µéªŒè¯ï¼šemailã€passwordã€confirmPassword
- å®æ—¶éªŒè¯ï¼šblur æ—¶è§¦å‘éªŒè¯
- Guardsï¼šä½¿ç”¨ `isFormValid` é˜²æ­¢æ— æ•ˆæäº¤
- é”™è¯¯å¤„ç†ï¼šåŒºåˆ†å­—æ®µé”™è¯¯å’Œæäº¤é”™è¯¯

**æç¤ºï¼š** å¯†ç è‡³å°‘ 6 ä¸ªå­—ç¬¦ï¼Œæœ‰ 10% çš„æ¦‚ç‡æ¨¡æ‹Ÿæäº¤å¤±è´¥

### 3. ğŸŒ æ•°æ®è·å–çŠ¶æ€æœº (FetchDemo)

å±•ç¤ºå¼‚æ­¥æ“ä½œã€é‡è¯•é€»è¾‘ã€å–æ¶ˆæ“ä½œå’Œé”™è¯¯æ¢å¤ã€‚

**æ ¸å¿ƒæ¦‚å¿µï¼š**
- é‡è¯•æœºåˆ¶ï¼šæœ€å¤šé‡è¯• 3 æ¬¡
- å–æ¶ˆæ“ä½œï¼šåŠ è½½ä¸­å¯ä»¥å–æ¶ˆè¯·æ±‚
- Guardsï¼š`canRetry` é™åˆ¶é‡è¯•æ¬¡æ•°
- çŠ¶æ€ç®¡ç†ï¼šåŒºåˆ† idleã€loadingã€successã€failure

**æç¤ºï¼š** å‰ä¸¤æ¬¡è¯·æ±‚ä¼šå¤±è´¥ï¼Œç¬¬ä¸‰æ¬¡æ‰ä¼šæˆåŠŸï¼ˆå±•ç¤ºé‡è¯•é€»è¾‘ï¼‰

### 4. â±ï¸ è®¡æ—¶å™¨çŠ¶æ€æœº (TimerDemo)

å±•ç¤ºæ—¶é—´ç›¸å…³çŠ¶æ€ã€after è½¬æ¢ã€å»¶è¿Ÿäº‹ä»¶å¤„ç†ã€‚

**æ ¸å¿ƒæ¦‚å¿µï¼š**
- after è½¬æ¢ï¼šä½¿ç”¨å»¶è¿Ÿäº‹ä»¶å®ç°å®šæ—¶æ›´æ–°
- çŠ¶æ€ç®¡ç†ï¼šidleã€runningã€pausedã€finished
- åŠ¨æ€å»¶è¿Ÿï¼šåŸºäº context çš„ interval
- è¿›åº¦è®¡ç®—ï¼šelapsed / duration

### 5. ğŸ§­ å¤šæ­¥éª¤å‘å¯¼çŠ¶æ€æœº (WizardDemo)

å±•ç¤ºé¡ºåºçŠ¶æ€æµè½¬ã€å†å²çŠ¶æ€ã€æ¡ä»¶å¯¼èˆªå’Œæ•°æ®æ”¶é›†ã€‚

**æ ¸å¿ƒæ¦‚å¿µï¼š**
- å¤šæ­¥éª¤æµç¨‹ï¼šstep1 â†’ step2 â†’ step3 â†’ review â†’ complete
- Guards éªŒè¯ï¼šæ¯ä¸€æ­¥éƒ½æœ‰éªŒè¯æ¡ä»¶
- å‰è¿›/åé€€ï¼šå¯ä»¥åœ¨æ­¥éª¤é—´å¯¼èˆª
- æ•°æ®æ”¶é›†ï¼šæ¯ä¸€æ­¥æ›´æ–°å¯¹åº”çš„ context
- ç›´æ¥è·³è½¬ï¼šåœ¨ review é¡µé¢å¯ä»¥è·³åˆ°ä»»æ„æ­¥éª¤ç¼–è¾‘

## ğŸ“ XState v5 æœ€ä½³å®è·µ

### 1. ä½¿ç”¨ `setup()` å‡½æ•°

```typescript
export const myMachine = setup({
  types: {
    context: {} as MyContext,
    events: {} as MyEvents,
  },
  guards: { /* guards å®šä¹‰ */ },
  actions: { /* actions å®šä¹‰ */ },
  actors: { /* actors å®šä¹‰ */ },
}).createMachine({
  /* çŠ¶æ€æœºé…ç½® */
})
```

### 2. ä½¿ç”¨ `fromPromise` åŒ…è£…å¼‚æ­¥æ“ä½œ

```typescript
actors: {
  fetchData: fromPromise(async ({ input }) => {
    return await api.fetch(input.id)
  }),
}
```

### 3. ä½¿ç”¨å¯¹è±¡æ ¼å¼å¼•ç”¨ actions å’Œ guards

```typescript
on: {
  SUBMIT: {
    target: 'submitting',
    actions: { type: 'validateForm' },  // âœ… å¯¹è±¡æ ¼å¼
    guard: { type: 'isValid' },          // âœ… å¯¹è±¡æ ¼å¼
  }
}
```

### 4. åœ¨ onDone/onError ä¸­ç›´æ¥ä½¿ç”¨ assign

```typescript
invoke: {
  src: 'fetchData',
  onDone: {
    target: 'success',
    actions: assign({
      data: ({ event }) => event.output,
    }),
  },
  onError: {
    target: 'error',
    actions: assign({
      error: ({ event }) => (event.error as Error).message,
    }),
  },
}
```

### 5. åˆ†ç¦»çŠ¶æ€æœºå’Œç»„ä»¶

- **çŠ¶æ€æœº** (`machines/`) - çº¯é€»è¾‘ï¼Œä¸ä¾èµ– React
- **ç»„ä»¶** (`components/`) - UI å±•ç¤ºï¼Œé€šè¿‡ `useMachine` è¿æ¥çŠ¶æ€æœº

### 6. TypeScript ç±»å‹å®šä¹‰

```typescript
type Context = {
  count: number
  error: string | null
}

type Events =
  | { type: 'INCREMENT' }
  | { type: 'DECREMENT' }
  | { type: 'RESET' }
```

## ğŸ“š å­¦ä¹ èµ„æº

- [XState å®˜æ–¹æ–‡æ¡£](https://xstate.js.org)
- [XState å¯è§†åŒ–å·¥å…·](https://stately.ai/viz)
- [XState v5 è¿ç§»æŒ‡å—](https://stately.ai/docs/migration)
- é¡¹ç›®å†…æ–‡æ¡£ï¼š`docs/xstate-knowledge.md` - è¯¦ç»†çš„çŸ¥è¯†ç‚¹æ€»ç»“

## ğŸ”§ æŠ€æœ¯æ ˆ

- **React** 19.1.1
- **XState** 5.23.0
- **@xstate/react** 6.0.0
- **TypeScript** 5.9.3
- **Vite** 7.1.7

## ğŸ’¡ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆä½¿ç”¨çŠ¶æ€æœºè€Œä¸æ˜¯ useStateï¼Ÿ

A: çŠ¶æ€æœºèƒ½å¤Ÿï¼š
- é¿å…ä¸ä¸€è‡´çš„çŠ¶æ€ï¼ˆå¦‚åŒæ—¶ loading å’Œ errorï¼‰
- æ˜ç¡®å®šä¹‰æ‰€æœ‰å¯èƒ½çš„çŠ¶æ€å’Œè½¬æ¢
- æä¾›æ›´å¥½çš„å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§
- å¯è§†åŒ–çŠ¶æ€æµè½¬

### Q: XState v5 å’Œ v4 æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

A: ä¸»è¦å˜åŒ–ï¼š
- ä½¿ç”¨ `setup()` å‡½æ•°ä»£æ›¿ç›´æ¥é…ç½®
- ä½¿ç”¨ `fromPromise` åŒ…è£…å¼‚æ­¥æ“ä½œ
- actions å’Œ guards ä½¿ç”¨å¯¹è±¡æ ¼å¼å¼•ç”¨
- æ›´å¥½çš„ TypeScript ç±»å‹æ¨æ–­

### Q: å¦‚ä½•è°ƒè¯•çŠ¶æ€æœºï¼Ÿ

A: å¯ä»¥ä½¿ç”¨ï¼š
1. æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹ state.value å’Œ state.context
2. XState Inspector (éœ€è¦é¢å¤–é…ç½®)
3. Stately å¯è§†åŒ–å·¥å…·

## ğŸ“ æ›´æ–°æ—¥å¿—

### 2025-11-03

- âœ… ä¿®å¤æ‰€æœ‰ XState v5 API å…¼å®¹æ€§é—®é¢˜
- âœ… ä¼˜åŒ–æ‰€æœ‰çŠ¶æ€æœºçš„ç±»å‹å®šä¹‰
- âœ… ä¿®å¤ç»„ä»¶ä¸­çš„ç±»å‹é”™è¯¯
- âœ… å®Œå–„æ–‡æ¡£å’Œæ³¨é‡Š
- âœ… ç¡®ä¿æ„å»ºæˆåŠŸ

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ License

MIT
